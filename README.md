# 光学衍射模拟库 (Optical Diffraction Simulation Library)

## 项目概述

这是一个高性能的光学衍射模拟C语言库，用于计算和模拟光波在自由空间中的传播行为。该库实现了三种经典的标量衍射理论方法，可以精确模拟从近场到远场的各种衍射现象。

## 核心功能

### 1. 三种衍射计算方法

- **菲涅尔衍射 (Fresnel Diffraction)**
  - 适用于近场和中场衍射
  - 基于菲涅尔-基尔霍夫衍射积分
  - 使用双FFT算法实现高效计算
  - 支持卷积方法作为备选实现

- **夫琅禾费衍射 (Fraunhofer Diffraction)**
  - 适用于远场衍射
  - 基于夫琅禾费近似
  - 计算速度最快
  - 支持正向和反向传播

- **角谱法 (Angular Spectrum Method)**
  - 最精确的方法，适用于所有距离
  - 基于平面波角谱理论
  - 正确处理倏逝波和传播波
  - 推荐用于高精度计算

### 2. 双向传播

- **正向传播**: 从物平面传播到像平面
- **反向传播**: 从像平面重建物平面
- 支持全息重建和相位恢复应用

### 3. 多色光支持

- 支持单色光和多色光（复色光）模拟
- 每个波长可设置独立的权重
- 自动进行多波长叠加计算
- 可模拟白光衍射和色散效应

### 4. 图像处理功能

- **复数场表示**: 完整保存振幅和相位信息
- **多种输出格式**:
  - 强度图 (Intensity)
  - 振幅图 (Amplitude)
  - 相位图 (Phase)
- **灵活的输入**: 支持从强度图或振幅图创建复数场

### 5. 性能优化

- **零填充 (Zero Padding)**: 减少周期性边界效应
- **FFTW库集成**: 使用业界最快的FFT库
- **FFTW Wisdom**: 支持FFT计划缓存，加速重复计算
- **批处理模式**: 高效处理多张图像
- **多步传播**: 支持分步传播以观察中间结果

## 技术特点

### 数学严谨性
- 基于标量衍射理论的严格数学推导
- 正确实现相位因子和传递函数
- 精确处理采样和频率坐标

### 数值稳定性
- 合理的归一化处理
- 避免数值溢出和下溢
- 正确处理边界条件

### 代码质量
- 清晰的模块化设计
- 完善的错误处理机制
- 详细的代码注释
- 符合C99标准

### 易用性
- 简洁的API设计
- 丰富的辅助函数
- 参数验证和智能建议
- 详细的错误信息

## 应用场景

### 1. 科学研究
- 光学系统设计与分析
- 衍射光学元件设计
- 全息术研究
- 光束传播模拟

### 2. 工程应用
- 光学成像系统仿真
- 激光束整形
- 光学测量系统设计
- 显微镜成像模拟

### 3. 教育培训
- 光学课程演示
- 衍射现象可视化
- 实验设计辅助
- 概念验证工具

### 4. 图像处理
- 数字全息重建
- 相位恢复算法
- 散焦模糊模拟
- 光学传递函数计算

## 主要优势

### 1. 完整性
- 涵盖三种主流衍射计算方法
- 支持正向和反向传播
- 提供完整的图像转换工具

### 2. 准确性
- 基于物理光学理论
- 经过严格的数学验证
- 正确处理各种物理效应

### 3. 高性能
- 利用FFT算法加速计算
- 支持大尺寸图像处理
- 优化的内存管理

### 4. 灵活性
- 可配置的参数系统
- 多种计算方法可选
- 支持自定义扩展

### 5. 可靠性
- 完善的错误处理
- 参数有效性检查
- 内存安全保证

## 技术规格

### 依赖库
- **FFTW3**: 快速傅里叶变换库
- **标准C库**: math.h, complex.h, string.h等

### 支持平台
- Linux
- macOS
- Windows (需要FFTW Windows版本)

### 编译要求
- C99或更高版本编译器
- FFTW3开发库
- CMake 3.10+ (推荐)

### 性能指标
- 1024×1024图像: ~50ms (单次传播)
- 2048×2048图像: ~200ms (单次传播)
- 内存占用: 约为图像大小的4-8倍

## 理论基础

### 标量衍射理论
基于以下基本假设：
1. 光波可用标量场描述
2. 满足亥姆霍兹方程
3. 满足基尔霍夫边界条件

### 传播方法对比

| 方法 | 适用范围 | 菲涅尔数 | 计算复杂度 | 精度 |
|------|---------|---------|-----------|------|
| 菲涅尔 | 近场-中场 | F > 1 | O(N²logN) | 高 |
| 夫琅禾费 | 远场 | F < 0.1 | O(N²logN) | 中 |
| 角谱法 | 全范围 | 任意 | O(N²logN) | 最高 |

### 菲涅尔数定义
```
F = a² / (λz)
```
其中：
- a: 孔径半径
- λ: 波长
- z: 传播距离

## 使用建议

### 方法选择
1. **高精度要求**: 使用角谱法
2. **远场计算**: 使用夫琅禾费衍射
3. **近场计算**: 使用菲涅尔衍射
4. **不确定**: 调用 `diffraction_suggest_method()` 获取建议

### 参数设置
1. **像素尺寸**: 应小于波长的1/2以满足采样定理
2. **传播距离**: 根据应用场景选择
3. **零填充**: 建议使用2-4倍填充因子
4. **图像尺寸**: 推荐使用2的幂次方以优化FFT性能

### 性能优化
1. 使用FFTW wisdom预计算FFT计划
2. 批处理多张图像
3. 合理选择填充因子
4. 使用单精度浮点数（已实现）


计划功能
- [ ] GPU加速支持 (CUDA/OpenCL)
- [ ] 矢量衍射理论
- [ ] 非傍轴传播
- [ ] 散射介质传播
- [ ] Python/MATLAB接口
- [ ] 可视化工具集成
- [ ] 并行计算支持
潜在应用
- 深度学习光学系统设计
- 计算成像算法开发
- 虚拟现实光学设计
- 光学神经网络模拟

欢迎提交问题报告、功能请求和代码贡献。请遵循以下原则：
- 保持代码风格一致
- 添加适当的注释
- 提供测试用例
- 更新相关文档

---

**注**: 本库专注于标量衍射理论的实现，不考虑偏振效应。对于需要考虑偏振的应用，请使用
